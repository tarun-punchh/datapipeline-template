bundle:
  name: datapipeline-template

include:
  - resources/*.yml

variables:
  source_location:
    description: "Full S3 path to source data and dp_config_template.json (e.g., s3://bucket/prefix/)"
  catalog_name:
    description: "Unity Catalog name for pipeline output tables"
  bronze_db:
    description: "Bronze schema/database name for raw ingestion tables"
  silver_db:
    description: "Silver schema/database name for deduplicated tables"
  external_location:
    description: "Optional external storage location for tables (e.g., s3://bucket/path/). When set, tables are created as external (unmanaged) tables at this location. When empty, tables are managed (default)."
    default: ""
  deleted_file_retention_duration:
    description: "Duration to keep logically deleted data files before physical deletion by VACUUM (e.g., 'interval 14 days'). Maps to delta.deletedFileRetentionDuration table property."
    default: "interval 14 days"
  soft_deletes:
    description: "Enable soft deletes: Y to keep op='D' records in silver tables and create _active views, N to filter them out"
    default: "N"
  trigger_frequency:
    description: "Job trigger frequency: daily (default), hourly, etc."
    default: "daily"

targets:
  dev:
    default: true
    mode: development
    workspace:
      host: https://<your-workspace>.cloud.databricks.com
    variables:
      source_location: "s3://punchh-data-pipeline/tarun-test/"
      catalog_name: "dev_catalog"
      bronze_db: "bronze"
      silver_db: "silver"
      external_location: ""  # empty = managed tables (default)

  prod:
    mode: production
    workspace:
      host: https://<your-workspace>.cloud.databricks.com
    variables:
      source_location: "s3://punchh-data-pipeline/prod/"
      catalog_name: "prod_catalog"
      bronze_db: "bronze"
      silver_db: "silver"
      external_location: ""  # empty = managed tables (default)
    permissions:
      - user_name: <prod-owner>@example.com
        level: CAN_MANAGE
